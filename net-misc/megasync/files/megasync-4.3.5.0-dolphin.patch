diff --git a/MEGAShellExtDolphin/CMakeLists.txt b/MEGAShellExtDolphin/CMakeLists.txt
index e9342ee..9b17436 100644
--- a/MEGAShellExtDolphin/CMakeLists.txt
+++ b/MEGAShellExtDolphin/CMakeLists.txt
@@ -1,13 +1,67 @@
 project(megasyncplugin)
 
-cmake_minimum_required(VERSION 2.8.7)
-FIND_PACKAGE( KDE4 REQUIRED )
-INCLUDE( KDE4Defaults )
+cmake_minimum_required(VERSION 2.8.12)
+include(FeatureSummary)
+set(QT_MIN_VERSION "5.0.0")
+set(KF5_MIN_VERSION "5.0.0")
+#set(KF5_MIN_VERSION "5.16.0")//for overlays
 
-include_directories( ${QT_INCLUDES} ${KDE4_INCLUDES} ${LIBKONQ_INCLUDE_DIR} )
+find_package(Qt5 ${QT_MIN_VERSION} CONFIG REQUIRED COMPONENTS Core Network)
 
-kde4_add_plugin(megasyncplugin megasync-plugin.cpp)
-target_link_libraries(megasyncplugin ${KDE4_KIO_LIBS})
+find_package(ECM 1.2.0 REQUIRED CONFIG)
+set(CMAKE_MODULE_PATH ${ECM_MODULE_PATH} ${ECM_KDE_MODULE_DIR} "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
 
-install(FILES megasync-plugin.desktop DESTINATION ${SERVICES_INSTALL_DIR})
-install(TARGETS megasyncplugin DESTINATION ${PLUGIN_INSTALL_DIR})
+find_package(KF5 ${KF5_MIN_VERSION} REQUIRED COMPONENTS CoreAddons KIO)
+#find_package(KF5 REQUIRED)
+
+set_package_properties(DolphinVcs PROPERTIES
+    DESCRIPTION "the Dolphin plugin library"
+    URL "http://dolphin.kde.org/"
+    TYPE REQUIRED
+    PURPOSE "Provides plugin interfaces for Dolphin."
+)
+
+include(KDEInstallDirs)
+include(KDECMakeSettings)
+include(KDECompilerSettings)
+include(ECMMarkNonGuiExecutable)
+include(GenerateExportHeader)
+
+set(CMAKE_AUTOMOC ON)
+
+include_directories(${CMAKE_CURRENT_BINARY_DIR})
+add_definitions(-DQT_USE_FAST_CONCATENATION -DQT_USE_FAST_OPERATOR_PLUS)
+add_definitions(-DWITH_KF5)
+
+
+#---OVERLAY PLUGIN---
+if (KF5_VERSION)
+	if (NOT KF5_VERSION VERSION_LESS 5.16.0)
+		set(MEGASYNCDOLPHINOVERLAYPLUGIN megasyncdolphinoverlayplugin)
+		if (NOT DEFINED PLUGIN_INSTALL_DIR)
+				set(PLUGIN_INSTALL_DIR ${CMAKE_INSTALL_LIBDIR}/qt5/plugins) #so that kcoreaddons install in the right path (see https://github.com/KDE/kcoreaddons/blob/master/KF5CoreAddonsMacros.cmake)
+		endif()
+		kcoreaddons_add_plugin(${MEGASYNCDOLPHINOVERLAYPLUGIN} INSTALL_NAMESPACE "kf5/overlayicon"
+							   JSON megasync-plugin-overlay.json SOURCES megasync-plugin-overlay.cpp)
+		#target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets ${MEGASYNCDOLPHINHELPER})
+		target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets)
+		#target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOCore KF5::KIOFileWidgets KF5::KIOWidgets KF5::KIONTLM)
+
+		#---- ICONS ---- 
+		set(HICOLOR_INSTALL_DIR ${KDE_INSTALL_FULL_ICONDIR}/hicolor)
+		file(GLOB_RECURSE FILES32 "data/emblems/32x32/*")
+		file(GLOB_RECURSE FILES64 "data/emblems/64x64/*")
+		install( FILES ${FILES32} DESTINATION ${HICOLOR_INSTALL_DIR}/32x32/emblems)
+		install( FILES ${FILES64} DESTINATION ${HICOLOR_INSTALL_DIR}/64x64/emblems)		
+	endif()
+endif()
+
+#---ACTION PLUGIN---
+set(MEGASYNCPLUGIN megasyncplugin)
+add_library(${MEGASYNCPLUGIN} MODULE megasync-plugin.cpp)
+target_link_libraries(${MEGASYNCPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets)
+#configure_file(megasync-plugin.desktop.in ${MEGASYNCPLUGIN}.desktop ESCAPE_QUOTES @ONLY)
+
+#install(FILES ${CMAKE_CURRENT_BINARY_DIR}/megasync-plugin.desktop DESTINATION ${KDE_INSTALL_KSERVICES5DIR})
+install(FILES megasync-plugin.desktop DESTINATION ${KDE_INSTALL_KSERVICES5DIR})
+install(TARGETS ${MEGASYNCPLUGIN} DESTINATION ${PLUGIN_INSTALL_DIR})
diff --git a/MEGAShellExtDolphin/CMakeLists_kde5.txt b/MEGAShellExtDolphin/CMakeLists_kde5.txt
deleted file mode 100644
index 1a1dd96..0000000
--- a/MEGAShellExtDolphin/CMakeLists_kde5.txt
+++ /dev/null
@@ -1,67 +0,0 @@
-project(megasyncplugin)
-
-cmake_minimum_required(VERSION 2.8.12)
-include(FeatureSummary)
-set(QT_MIN_VERSION "5.0.0")
-set(KF5_MIN_VERSION "5.0.0")
-#set(KF5_MIN_VERSION "5.16.0")//for overlays
-
-find_package(Qt5 ${QT_MIN_VERSION} CONFIG REQUIRED COMPONENTS Core Network)
-
-find_package(ECM 1.2.0 REQUIRED CONFIG)
-set(CMAKE_MODULE_PATH ${ECM_MODULE_PATH} ${ECM_KDE_MODULE_DIR} "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
-
-find_package(KF5 ${KF5_MIN_VERSION} REQUIRED COMPONENTS CoreAddons KIO)
-#find_package(KF5 REQUIRED)
-
-set_package_properties(DolphinVcs PROPERTIES
-    DESCRIPTION "the Dolphin plugin library"
-    URL "http://dolphin.kde.org/"
-    TYPE REQUIRED
-    PURPOSE "Provides plugin interfaces for Dolphin."
-)
-
-include(KDEInstallDirs)
-include(KDECMakeSettings)
-include(KDECompilerSettings)
-include(ECMMarkNonGuiExecutable)
-include(GenerateExportHeader)
-
-set(CMAKE_AUTOMOC ON)
-
-include_directories(${CMAKE_CURRENT_BINARY_DIR})
-add_definitions(-DQT_USE_FAST_CONCATENATION -DQT_USE_FAST_OPERATOR_PLUS)
-add_definitions(-DWITH_KF5)
-
-
-#---OVERLAY PLUGIN---
-if (KF5_VERSION)
-	if (NOT KF5_VERSION VERSION_LESS 5.16.0)
-		set(MEGASYNCDOLPHINOVERLAYPLUGIN megasyncdolphinoverlayplugin)
-		if (NOT DEFINED PLUGIN_INSTALL_DIR)
-				set(PLUGIN_INSTALL_DIR ${CMAKE_INSTALL_LIBDIR}/qt5/plugins) #so that kcoreaddons install in the right path (see https://github.com/KDE/kcoreaddons/blob/master/KF5CoreAddonsMacros.cmake)
-		endif()
-		kcoreaddons_add_plugin(${MEGASYNCDOLPHINOVERLAYPLUGIN} INSTALL_NAMESPACE "kf5/overlayicon"
-							   JSON megasync-plugin-overlay.json SOURCES megasync-plugin-overlay.cpp)
-		#target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets ${MEGASYNCDOLPHINHELPER})
-		target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets)
-		#target_link_libraries(${MEGASYNCDOLPHINOVERLAYPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOCore KF5::KIOFileWidgets KF5::KIOWidgets KF5::KIONTLM)
-
-		#---- ICONS ---- 
-		set(HICOLOR_INSTALL_DIR ${KDE_INSTALL_FULL_ICONDIR}/hicolor)
-		file(GLOB_RECURSE FILES32 "data/emblems/32x32/*")
-		file(GLOB_RECURSE FILES64 "data/emblems/64x64/*")
-		install( FILES ${FILES32} DESTINATION ${HICOLOR_INSTALL_DIR}/32x32/emblems)
-		install( FILES ${FILES64} DESTINATION ${HICOLOR_INSTALL_DIR}/64x64/emblems)		
-	endif()
-endif()
-
-#---ACTION PLUGIN---
-set(MEGASYNCPLUGIN megasyncplugin)
-add_library(${MEGASYNCPLUGIN} MODULE megasync-plugin.cpp)
-target_link_libraries(${MEGASYNCPLUGIN} KF5::CoreAddons KF5::KIOCore KF5::KIOWidgets)
-#configure_file(megasync-plugin.desktop.in ${MEGASYNCPLUGIN}.desktop ESCAPE_QUOTES @ONLY)
-
-#install(FILES ${CMAKE_CURRENT_BINARY_DIR}/megasync-plugin.desktop DESTINATION ${KDE_INSTALL_KSERVICES5DIR})
-install(FILES megasync-plugin.desktop DESTINATION ${KDE_INSTALL_KSERVICES5DIR})
-install(TARGETS ${MEGASYNCPLUGIN} DESTINATION ${CMAKE_INSTALL_LIBDIR}/qt5/plugins)
diff --git a/MEGAShellExtDolphin/megasync-plugin.moc b/MEGAShellExtDolphin/megasync-plugin.moc
deleted file mode 100644
index e69de29..0000000
